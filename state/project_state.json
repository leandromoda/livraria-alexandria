{
  "meta": {
    "project_name": "Livraria Alexandria",
    "description": "Plataforma de livraria afiliada baseada em SEO programático, listas de decisão e páginas de livros, com monetização via redirecionamento afiliado.",
    "current_phase": "pilot_functional_interlinked_with_ingest_pipeline",
    "last_updated": "2026-02-14",
    "owner": "Leandro Moda",
    "environment": "local",
    "runtime_stack": {
      "node": "Next.js App Router (Edge Runtime ativo)",
      "database_primary": "Supabase",
      "database_staging": "SQLite (pipeline local)",
      "llm_local": "Ollama",
      "llm_model": "phi3:mini",
      "python_env": "venv (Windows)",
      "ingest_language": "Python 3.14"
    }
  },

  "objectives": {
    "primary": "Piloto funcional monetizável com interlinking entre listas, livros e ofertas.",
    "secondary": [
      "Validar funil Lista → Livro → Oferta → Afiliado",
      "Validar JOIN ofertas ↔ livros",
      "Estabelecer malha mínima de interlinking",
      "Preparar base para tracking afiliado",
      "Escalar geração programática de páginas via ingest automatizado"
    ],
    "non_goals": [
      "Checkout próprio",
      "Gestão de estoque",
      "Autenticação de usuários finais nesta fase"
    ]
  },

  "architecture": {
    "high_level_description": "Aplicação monolítica em Next.js (App Router) com pipeline externo de ingestão modular em Python.",

    "route_groups": {
      "public": "Páginas indexáveis e SEO",
      "internal": "Infraestrutura e APIs"
    },

    "modules": [
      {
        "name": "Páginas de Livro",
        "status": "operational",
        "schema_org": "Product + Offer",
        "path": "app/(public)/livros/[slug]"
      },
      {
        "name": "Listas SEO",
        "status": "operational",
        "schema_org": "ItemList + Book",
        "path": "app/(public)/listas/[slug]"
      },
      {
        "name": "Página de Ofertas",
        "status": "operational",
        "schema_org": "ItemList + Product + Offer",
        "path": "app/(public)/ofertas"
      },
      {
        "name": "Click Tracking",
        "status": "operational",
        "path": "app/(internal)/api/click/[id]"
      }
    ]
  },

  "monetization": {
    "model": "affiliate_redirect",
    "status": "functional",
    "flows": [
      "Lista → Livro",
      "Livro → Oferta",
      "Oferta → Afiliado"
    ]
  },

  "tracking": {
    "status": "implemented",
    "table": "oferta_clicks",
    "deduplication": "pending"
  },

  "interlinking": {
    "implemented": [
      "Lista → Livro",
      "Livro → Lista",
      "Livro → Oferta",
      "Oferta → Livro",
      "Lista ↔ Lista"
    ],
    "pending": [
      "Livro → Livros relacionados",
      "Autor → Livro",
      "Categoria → Livro"
    ]
  },

  "seo_structured_data": {
    "livro_page": "Product + Offer",
    "listas_page": "ItemList + Book",
    "ofertas_page": "ItemList + Product + Offer",
    "aggregate_offer": "pending"
  },

  "data_layer": {
    "production": {
      "provider": "Supabase",
      "status": "connected",
      "rls_public_read": true
    },
    "staging": {
      "provider": "SQLite",
      "role": "Ingest + Enrichment + QA + Dedup",
      "status": "operational"
    }
  },

  "ingest_pipeline": {

    "status": "operational_incremental",

    "execution": {
      "entrypoint": "scripts/main.py",
      "mode": "menu_driven",
      "interrupt_resume": true,
      "heartbeat": "30s",
      "logging": "timestamped_terminal"
    },

    "state_management": {
      "progress_storage": "SQLite",
      "granularity": [
        "per_step",
        "per_record",
        "per_batch"
      ],
      "resume_strategy": "auto_continue_from_last_offset"
    },

    "cluster_strategy": {
      "type": "library_grade_taxonomy",
      "scope": "expanded_exhaustive",
      "languages_supported": [
        "Portuguese",
        "English",
        "Spanish",
        "Italian"
      ]
    },

    "steps": [

      {
        "order": 1,
        "name": "Prospect",
        "script": "steps/prospect.py",
        "status": "operational",
        "sources": [
          "OpenLibrary",
          "Google Books",
          "ISBNdb (planned)"
        ],
        "extracted_fields": [
          "titulo",
          "autor",
          "isbn",
          "first_publish_year"
        ],
        "batch_sizes": [10, 20, 50, 100, 500, 1000]
      },

      {
        "order": 2,
        "name": "Slugify",
        "script": "steps/slugify.py",
        "status": "operational",
        "features": [
          "Unicode normalize",
          "SEO safe",
          "collision incremental"
        ]
      },

      {
        "order": 3,
        "name": "Deduplicate",
        "script": "steps/dedup.py",
        "status": "operational",
        "match_rules": [
          "titulo",
          "isbn",
          "slug"
        ]
      },

      {
        "order": 4,
        "name": "Synopsis Generation",
        "script": "steps/synopsis.py",
        "status": "operational",
        "llm": "Ollama",
        "model": "phi3:mini"
      },

      {
        "order": 5,
        "name": "Synopsis Review",
        "script": "steps/review.py",
        "status": "operational",
        "features": [
          "Grammar fix",
          "Editorial tone",
          "Slug review"
        ]
      },

      {
        "order": 6,
        "name": "Cover Enrichment",
        "script": "steps/covers.py",
        "status": "operational",
        "sources": [
          "OpenLibrary Covers",
          "Google Books Covers"
        ]
      },

      {
        "order": 7,
        "name": "Publish",
        "script": "steps/publish.py",
        "status": "operational_with_blocker",
        "target": "Supabase",
        "mode": "batch_upsert",
        "blockers": [
          {
            "type": "uuid_format_mismatch",
            "description": "IDs locais não estão no formato UUID aceito pelo Supabase",
            "impact": "Falha HTTP 400 no upsert",
            "resolution_strategy": [
              "Gerar UUID v4 no ingest",
              "Ou mapear UUID no publish"
            ]
          }
        ]
      }
    ]
  },

  "validated_routes": [
    "/",
    "/livros/[slug]",
    "/listas/[slug]",
    "/ofertas"
  ],

  "open_tasks": [
    {
      "id": "TASK-TRACK-001",
      "description": "Deduplicação de cliques afiliados",
      "priority": "medium"
    },
    {
      "id": "TASK-SEO-003",
      "description": "AggregateOffer por livro",
      "priority": "medium"
    },
    {
      "id": "TASK-INGEST-002",
      "description": "Expandir fontes (ISBNdb, Amazon, Goodreads)",
      "priority": "low"
    },
    {
      "id": "TASK-INGEST-UUID-004",
      "description": "Normalizar UUID entre SQLite e Supabase",
      "priority": "high"
    }
  ],

  "next_scaling_targets": {
    "books": 500,
    "listas": 50,
    "offers_per_book_avg": 3
  }
}
