primary_key\": \"id\",\n      \"fields\": [\n        { \"name\": \"id\", \"type\": \"TEXT\" },\n        { \"name\": \"livro_id_origem\", \"type\": \"TEXT\" },\n        { \"name\": \"livro_id_duplicado\", \"type\": \"TEXT\" },\n        {\n          \"name\": \"criterio\",\n          \"type\": \"TEXT\",\n          \"description\": \"slug | isbn | titulo_similar\"\n        },\n        {\n          \"name\": \"acao\",\n          \"type\": \"TEXT\",\n          \"description\": \"removido | mesclado | ignorado\"\n        },\n        {\n          \"name\": \"created_at\",\n          \"type\": \"DATETIME\"\n        }\n      ]\n    },\n\n    {\n      \"name\": \"ingest_runs\",\n      \"description\": \"Hist√≥rico de execu√ß√µes de prospec√ß√£o\",\n      \"primary_key\": \"id\",\n      \"fields\": [\n        { \"name\": \"id\", \"type\": \"TEXT\" },\n        { \"name\": \"idioma\", \"type\": \"TEXT\" },\n        { \"name\": \"pacote\", \"type\": \"INTEGER\" },\n        {\n          \"name\": \"clusters_usados\",\n          \"type\": \"TEXT\",\n          \"description\": \"JSON string\"\n        },\n        { \"name\": \"inseridos\", \"type\": \"INTEGER\" },\n        { \"name\": \"skips\", \"type\": \"INTEGER\" },\n        { \"name\": \"created_at\", \"type\": \"DATETIME\" }\n      ]\n    },\n\n    {\n      \"name\": \"pipeline_state\",\n      \"description\": \"Estado global resum√≠vel do pipeline\",\n      \"primary_key\": \"key\",\n      \"fields\": [\n        { \"name\": \"key\", \"type\": \"TEXT\" },\n        { \"name\": \"value\", \"type\": \"TEXT\" },\n        { \"name\": \"updated_at\", \"type\": \"DATETIME\" }\n      ],\n      \"examples\": [\n        {\n          \"key\": \"last_cluster_index\",\n          \"value\": \"12\"\n        },\n        {\n          \"key\": \"last_run_id\",\n          \"value\": \"uuid\"\n        }\n      ]\n    }\n  ],\n\n  \"indexes\": [\n    {\n      \"table\": \"livros\",\n      \"fields\": [\"slug\"],\n      \"unique\": true\n    },\n    {\n      \"table\": \"livros\",\n      \"fields\": [\"isbn\"]\n    },\n    {\n      \"table\": \"livros\",\n      \"fields\": [\"cluster\"]\n    },\n    {\n      \"table\": \"livros\",\n      \"fields\": [\"status_publish\"]\n    }\n  ],\n\n  \"relationships\": [],\n\n  \"publish_layer\": {\n    \"target\": \"Supabase.livros\",\n    \"mode\": \"REST upsert\",\n    \"status\": \"blocked\",\n    \"blocking_issue\": \"invalid input syntax for type uuid\",\n    \"root_cause\": \"staging IDs n√£o seguem UUID v4\",\n    \"resolution_path\": [\n      \"Gerar UUID v4 no publish\",\n      \"Ou migrar staging IDs\",\n      \"Ou alterar schema Supabase para TEXT\"\n    ]\n  },\n\n  \"data_flow\": [\n    \"prospect ‚Üí livros (insert)\",\n    \"slugify ‚Üí livros.slug\",\n    \"dedup ‚Üí dedup_log + status_dedup\",\n    \"synopsis ‚Üí livros.descricao\",\n    \"review ‚Üí overwrite descricao\",\n    \"cover ‚Üí livros.imagem_url\",\n    \"publish ‚Üí status_publish = 1\"\n  ]\n}\n",
    "state\\project_state.json": "{\n  \"meta\": {\n    \"project_name\": \"Livraria Alexandria\",\n    \"description\": \"Plataforma de livraria afiliada baseada em SEO program√°tico, listas de decis√£o e p√°ginas de livros, com monetiza√ß√£o via redirecionamento afiliado.\",\n    \"current_phase\": \"pilot_functional_interlinked_taxonomy_active_idioma_aware\",\n    \"last_updated\": \"2026-02-16\",\n    \"owner\": \"Leandro Moda\",\n    \"environment\": \"local\",\n    \"runtime_stack\": {\n      \"node\": \"Next.js App Router (Edge Runtime ativo)\",\n      \"database_primary\": \"Supabase\",\n      \"database_staging\": \"SQLite (pipeline local)\",\n      \"llm_local\": \"Ollama\",\n      \"llm_model\": \"phi3:mini\",\n      \"python_env\": \"venv (Windows)\",\n      \"ingest_language\": \"Python 3.14\"\n    }\n  },\n\n  \"objectives\": {\n    \"primary\": \"Piloto funcional monetiz√°vel com interlinking entre listas, livros, categorias e ofertas.\",\n    \"secondary\": [\n      \"Validar funil Lista ‚Üí Livro ‚Üí Oferta ‚Üí Afiliado\",\n      \"Validar JOIN ofertas ‚Üî livros\",\n      \"Estabelecer malha m√≠nima de interlinking\",\n      \"Ativar taxonomia naveg√°vel\",\n      \"Preparar base para tracking afiliado\",\n      \"Escalar gera√ß√£o program√°tica via ingest\"\n    ],\n    \"non_goals\": [\n      \"Checkout pr√≥prio\",\n      \"Gest√£o de estoque\",\n      \"Autentica√ß√£o de usu√°rios finais nesta fase\"\n    ]\n  },\n\n  \"architecture\": {\n    \"high_level_description\": \"Aplica√ß√£o monol√≠tica em Next.js (App Router) com pipeline externo modular em Python.\",\n\n    \"route_groups\": {\n      \"public\": \"P√°ginas index√°veis e SEO\",\n      \"internal\": \"Infraestrutura e APIs\"\n    },\n\n    \"modules\": [\n      {\n        \"name\": \"P√°ginas de Livro\",\n        \"status\": \"operational\",\n        \"schema_org\": \"Product + Offer\",\n        \"path\": \"app/(public)/livros/[slug]\"\n      },\n      {\n        \"name\": \"Listas SEO\",\n        \"status\": \"operational\",\n        \"schema_org\": \"ItemList + Book\",\n        \"path\": \"app/(public)/listas/[slug]\"\n      },\n      {\n        \"name\": \"Categorias (Taxonomia)\",\n        \"status\": \"operational\",\n        \"schema_org\": \"CollectionPage\",\n        \"path\": \"app/(public)/categorias/[slug]\"\n      },\n      {\n        \"name\": \"Hub Categorias\",\n        \"status\": \"operational\",\n        \"path\": \"app/(public)/categorias\"\n      },\n      {\n        \"name\": \"P√°gina de Ofertas\",\n        \"status\": \"operational\",\n        \"schema_org\": \"ItemList + Product + Offer\",\n        \"path\": \"app/(public)/ofertas\"\n      },\n      {\n        \"name\": \"Click Tracking\",\n        \"status\": \"operational\",\n        \"path\": \"app/(internal)/api/click/[id]\"\n      }\n    ]\n  },\n\n  \"monetization\": {\n    \"model\": \"affiliate_redirect\",\n    \"status\": \"functional\",\n    \"flows\": [\n      \"Lista ‚Üí Livro\",\n      \"Livro ‚Üí Oferta\",\n      \"Oferta ‚Üí Afiliado\"\n    ]\n  },\n\n  \"tracking\": {\n    \"status\": \"implemented\",\n    \"table\": \"oferta_clicks\",\n    \"deduplication\": \"pending\"\n  },\n\n  \"interlinking\": {\n    \"implemented\": [\n      \"Lista ‚Üí Livro\",\n      \"Livro ‚Üí Lista\",\n      \"Livro ‚Üí Oferta\",\n      \"Oferta ‚Üí Livro\",\n      \"Lista ‚Üî Lista\",\n      \"Livro ‚Üí Categoria\",\n      \"Categoria ‚Üí Livro\",\n      \"Categoria ‚Üí Listas (auto)\",\n      \"Categoria ‚Üí Listas (editorial layer ready)\"\n    ],\n    \"pending\": [\n      \"Livro ‚Üí Livros relacionados\",\n      \"Autor ‚Üí Livro\",\n      \"Aggregate relevance ordering\"\n    ]\n  },\n\n  \"taxonomy\": {\n    \"status\": \"active\",\n    \"layers\": {\n      \"livros_categorias\": \"operational\",\n      \"listas_categorias\": \"operational_empty\",\n      \"inferencia_automatica\": \"operational\"\n    },\n    \"ordering\": {\n      \"pivot_weight\": true,\n      \"editorial_priority\": true\n    }\n  },\n\n  \"seo_structured_data\": {\n    \"livro_page\": \"Product + Offer\",\n    \"listas_page\": \"ItemList + Book\",\n    \"ofertas_page\": \"ItemList + Product + Offer\",\n    \"categorias_page\": \"CollectionPage\",\n    \"aggregate_offer\": \"pending\"\n  },\n\n  \"data_layer\": {\n    \"production\": {\n      \"provider\": \"Supabase\",\n      \"status\": \"connected\",\n      \"rls_public_read\": true\n    },\n    \"staging\": {\n      \"provider\": \"SQLite\",\n      \"role\": \"Ingest + Enrichment + QA + Dedup\",\n      \"status\": \"operational\"\n    }\n  },\n\n  \"ingest_pipeline\": {\n    \"status\": \"operational_idioma_aware\",\n\n    \"execution\": {\n      \"entrypoint\": \"scripts/main.py\",\n      \"mode\": \"menu_driven\",\n      \"interrupt_resume\": true,\n      \"heartbeat\": \"30s\",\n      \"logging\": \"timestamped_terminal\",\n      \"idioma_partitioning\": true\n    },\n\n    \"state_management\": {\n      \"progress_storage\": \"SQLite\",\n      \"granularity\": [\n        \"per_step\",\n        \"per_record\",\n        \"per_batch\"\n      ],\n      \"resume_strategy\": \"auto_continue_from_last_offset\",\n      \"segmented_by_language\": true\n    },\n\n    \"cluster_strategy\": {\n      \"type\": \"library_grade_taxonomy\",\n      \"scope\": \"expanded_exhaustive\",\n      \"languages_supported\": [\n        \"Portuguese\",\n        \"English\",\n        \"Spanish\",\n        \"Italian\"\n      ],\n      \"language_isolation\": true\n    },\n\n    \"steps\": [\n      {\n        \"order\": 1,\n        \"name\": \"Prospect\",\n        \"status\": \"operational\",\n        \"idioma_aware\": true,\n        \"source_filters\": [\n          \"OpenLibrary.language\",\n          \"GoogleBooks.langRestrict\"\n        ]\n      },\n      {\n        \"order\": 2,\n        \"name\": \"Slugify\",\n        \"status\": \"operational\",\n        \"idioma_aware\": true\n      },\n      {\n        \"order\": 3,\n        \"name\": \"Deduplicate\",\n        \"status\": \"operational\",\n        \"idioma_aware\": true,\n        \"merge_scope\": \"intra-language\"\n      },\n      {\n        \"order\": 4,\n        \"name\": \"Synopsis Generation\",\n        \"status\": \"operational\",\n        \"idioma_aware\": true,\n        \"llm\": \"phi3:mini\"\n      },\n      {\n        \"order\": 5,\n        \"name\": \"Synopsis Review\",\n        \"status\": \"operational\",\n        \"idioma_aware\": true,\n        \"llm\": \"phi3:mini\"\n      },\n      {\n        \"order\": 6,\n        \"name\": \"Cover Enrichment\",\n        \"status\": \"operational\",\n        \"idioma_aware\": true,\n        \"fallback\": \"Google Books\"\n      },\n      {\n        \"order\": 7,\n        \"name\": \"Quality Gate\",\n        \"status\": \"operational\",\n        \"idioma_aware\": true,\n        \"scoring_model\": {\n          \"fields\": [\n            \"slug\",\n            \"descricao\",\n            \"imagem_url\",\n            \"status_review\"\n          ],\n          \"min_score_publish\": 3\n        }\n      },\n      {\n        \"order\": 8,\n        \"name\": \"Publish\",\n        \"status\": \"operational\",\n        \"idioma_aware\": true,\n        \"id_strategy\": \"uuid_v4_on_publish\",\n        \"round_trip_id\": true,\n        \"blockers\": []\n      }\n    ]\n  },\n\n  \"validated_routes\": [\n    \"/\",\n    \"/livros\",\n    \"/livros/[slug]\",\n    \"/listas/[slug]\",\n    \"/categorias\",\n    \"/categorias/[slug]\",\n    \"/ofertas\"\n  ],\n\n  \"open_tasks\": [\n    {\n      \"id\": \"TASK-TRACK-001\",\n      \"description\": \"Deduplica√ß√£o de cliques afiliados\",\n      \"priority\": \"medium\"\n    },\n    {\n      \"id\": \"TASK-SEO-003\",\n      \"description\": \"AggregateOffer por livro\",\n      \"priority\": \"medium\"\n    }\n  ]\n}\n",
    "state\\backup\\2026-02-15_08-51_pipeline_full_part_001.json": "{\n  \"sqlite_dump\": {\n    \"livros\": [\n      {\n        \"name\": \"id\",\n        \"type\": \"TEXT\"\n      },\n      {\n        \"name\": \"titulo\",\n        \"type\": \"TEXT\"\n      },\n      {\n        \"name\": \"slug\",\n        \"type\": \"TEXT\"\n      },\n      {\n        \"name\": \"autor\",\n        \"type\": \"TEXT\"\n      },\n      {\n        \"name\": \"descricao\",\n        \"type\": \"TEXT\"\n      },\n      {\n        \"name\": \"isbn\",\n        \"type\": \"TEXT\"\n      },\n      {\n        \"name\": \"ano_publicacao\",\n        \"type\": \"INTEGER\"\n      },\n      {\n        \"name\": \"imagem_url\",\n        \"type\": \"TEXT\"\n      },\n      {\n        \"name\": \"idioma\",\n        \"type\": \"TEXT\"\n      },\n      {\n        \"name\": \"cluster\",\n        \"type\": \"TEXT\"\n      },\n      {\n        \"name\": \"fonte\",\n        \"type\": \"TEXT\"\n      },\n      {\n        \"name\": \"status_slug\",\n        \"type\": \"INTEGER\"\n      },\n      {\n        \"name\": \"status_dedup\",\n        \"type\": \"INTEGER\"\n      },\n      {\n        \"name\": \"status_synopsis\",\n        \"type\": \"INTEGER\"\n      },\n      {\n        \"name\": \"status_review\",\n        \"type\": \"INTEGER\"\n      },\n      {\n        \"name\": \"status_cover\",\n        \"type\": \"INTEGER\"\n      },\n      {\n        \"name\": \"status_publish\",\n        \"type\": \"INTEGER\"\n      },\n      {\n        \"name\": \"created_at\",\n        \"type\": \"DATETIME\"\n      },\n      {\n        \"name\": \"updated_at\",\n        \"type\": \"DATETIME\"\n      }\n    ]\n  },\n  \"files\": {\n    \"scripts\\\\main.py\": \"import time\\nimport threading\\n\\nfrom steps import prospect\\nfrom steps import slugify\\nfrom steps import dedup\\nfrom steps import synopsis\\nfrom steps import review\\nfrom steps import covers\\nfrom steps import publish\\n\\nfrom steps.export_state_transcript import export_state_transcript  # ‚Üê NOVO\\n\\n\\n# =========================\\n# INPUT CONTROL\\n# =========================\\n\\nINPUT_MODE = False\\nlast_activity = time.time()\\n\\n\\ndef log(msg):\\n    now = time.strftime(\\\"%H:%M:%S\\\")\\n    print(f\\\"[{now}] {msg}\\\")\\n\\n\\n# =========================\\n# HEARTBEAT\\n# =========================\\n\\ndef heartbeat():\\n    global INPUT_MODE\\n\\n    while True:\\n\\n        if not INPUT_MODE:\\n            elapsed = int(time.time() - last_activity)\\n            log(f\\\"Script ativo‚Ä¶ √∫ltimo evento h√° {elapsed}s\\\")\\n\\n        time.sleep(30)\\n\\n\\nthreading.Thread(target=heartbeat, daemon=True).start()\\n\\n\\n# =========================\\n# INPUT SAFE\\n# =========================\\n\\ndef input_safe(text):\\n\\n    global INPUT_MODE, last_activity\\n\\n    INPUT_MODE = True\\n    val = input(text)\\n    INPUT_MODE = False\\n\\n    last_activity = time.time()\\n\\n    return val\\n\\n\\n# =========================\\n# IDIOMA\\n# =========================\\n\\ndef escolher_idioma():\\n\\n    print(\\\"\\\"\\\"\\nEscolha o idioma base:\\n\\n1 ‚Üí Portugu√™s (padr√£o)\\n2 ‚Üí Ingl√™s\\n3 ‚Üí Espanhol\\n4 ‚Üí Italiano\\n\\\"\\\"\\\")\\n\\n    op = input_safe(\\\"Idioma: \\\")\\n\\n    return {\\n        \\\"1\\\": \\\"pt\\\",\\n        \\\"2\\\": \\\"en\\\",\\n        \\\"3\\\": \\\"es\\\",\\n        \\\"4\\\": \\\"it\\\"\\n    }.get(op, \\\"pt\\\")\\n\\n\\n# =========================\\n# PACOTE\\n# =========================\\n\\ndef escolher_pacote():\\n\\n    print(\\\"\\\"\\\"\\nEscolha tamanho do pacote:\\n\\n10 | 20 | 50 | 100 | 500 | 1000\\n\\\"\\\"\\\")\\n\\n    return int(input_safe(\\\"Pacote: \\\"))\\n\\n\\n# =========================\\n# MAIN LOOP\\n# =========================\\n\\ndef main():\\n\\n    idioma = escolher_idioma()\\n\\n    while True:\\n\\n        print(\\\"\\\"\\\"\\n=== LIVRARIA ALEXANDRIA ‚Äî INGEST PIPELINE ===\\n\\n1 ‚Üí Prospectar livros\\n2 ‚Üí Gerar slugs\\n3 ‚Üí Deduplicar\\n4 ‚Üí Gerar sinopses\\n5 ‚Üí Revisar sinopses\\n6 ‚Üí Gerar capas\\n7 ‚Üí Publicar Supabase\\n\\n8 ‚Üí Exportar State Transcript   ‚Üê NOVO\\n\\n0 ‚Üí Sair\\n\\\"\\\"\\\")\\n\\n        op = input_safe(\\\"Op√ß√£o: \\\")\\n\\n        if op == \\\"0\\\":\\n            break\\n\\n        if op == \\\"1\\\":\\n            pacote = escolher_pacote()\\n            prospect.run(idioma, pacote)\\n\\n        elif op == \\\"2\\\":\\n            pacote = escolher_pacote()\\n            slugify.run(pacote)\\n\\n        elif op == \\\"3\\\":\\n            pacote = escolher_pacote()\\n            dedup.run(pacote)\\n\\n        elif op == \\\"4\\\":\\n            pacote = escolher_pacote()\\n            synopsis.run(pacote)\\n\\n        elif op == \\\"5\\\":\\n            pacote = escolher_pacote()\\n            review.run(pacote)\\n\\n        elif op == \\\"6\\\":\\n            pacote = escolher_pacote()\\n            covers.run(pacote)\\n\\n        elif op == \\\"7\\\":\\n            pacote = escolher_pacote()\\n            publish.run(pacote)\\n\\n        elif op == \\\"8\\\":\\n            log(\\\"Gerando state transcript‚Ä¶\\\")\\n            export_state_transcript()\\n            log(\\\"Transcript conclu√≠do.\\\")\\nimport time\\nimport threading\\n\\nfrom steps import prospect\\nfrom steps import slugify\\nfrom steps import dedup\\nfrom steps import synopsis\\nfrom steps import review\\nfrom steps import covers\\nfrom steps import publish\\n\\nfrom steps.export_state_transcript import export_state_transcript\\n\\n\\n# =========================\\n# INPUT CONTROL\\n# =========================\\n\\nINPUT_MODE = False\\nlast_activity = time.time()\\n\\n\\ndef log(msg):\\n    now = time.strftime(\\\"%H:%M:%S\\\")\\n    print(f\\\"[{now}] {msg}\\\")\\n\\n\\n# =========================\\n# HEARTBEAT\\n# =========================\\n\\ndef heartbeat():\\n    global INPUT_MODE\\n\\n    while True:\\n\\n        if not INPUT_MODE:\\n            elapsed = int(time.time() - last_activity)\\n            log(f\\\"Script ativo‚Ä¶ √∫ltimo evento h√° {elapsed}s\\\")\\n\\n        time.sleep(30)\\n\\n\\nthreading.Thread(target=heartbeat, daemon=True).start()\\n\\n\\n# =========================\\n# INPUT SAFE\\n# =========================\\n\\ndef input_safe(text):\\n\\n    global INPUT_MODE, last_activity\\n\\n    INPUT_MODE = True\\n    val = input(text)\\n    INPUT_MODE = False\\n\\n    last_activity = time.time()\\n\\n    return val\\n\\n\\n# =========================\\n# IDIOMA\\n# =========================\\n\\ndef escolher_idioma():\\n\\n    print(\\\"\\\"\\\"\\nEscolha o idioma base:\\n\\n1 ‚Üí Portugu√™s (padr√£o)\\n2 ‚Üí Ingl√™s\\n3 ‚Üí Espanhol\\n4 ‚Üí Italiano\\n\\\"\\\"\\\")\\n\\n    op = input_safe(\\\"Idioma: \\\")\\n\\n    return {\\n        \\\"1\\\": \\\"pt\\\",\\n        \\\"2\\\": \\\"en\\\",\\n        \\\"3\\\": \\\"es\\\",\\n        \\\"4\\\": \\\"it\\\"\\n    }.get(op, \\\"pt\\\")\\n\\n\\n# =========================\\n# PACOTE\\n# =========================\\n\\ndef escolher_pacote():\\n\\n    print(\\\"\\\"\\\"\\nEscolha tamanho do pacote:\\n\\n10 | 20 | 50 | 100 | 500 | 1000\\n\\\"\\\"\\\")\\n\\n    return int(input_safe(\\\"Pacote: \\\"))\\n\\n\\n# =========================\\n# MAIN LOOP\\n# =========================\\n\\ndef main():\\n\\n    idioma = escolher_idioma()\\n\\n    while True:\\n\\n        print(\\\"\\\"\\\"\\n=== LIVRARIA ALEXANDRIA ‚Äî INGEST PIPELINE ===\\n\\n1 ‚Üí Prospectar livros\\n2 ‚Üí Gerar slugs\\n3 ‚Üí Deduplicar\\n4 ‚Üí Gerar sinopses\\n5 ‚Üí Revisar sinopses\\n6 ‚Üí Gerar capas\\n7 ‚Üí Publicar Supabase\\n\\n8 ‚Üí Export Site Transcript\\n9 ‚Üí Export Pipeline Transcript\\n10 ‚Üí Export Full Transcript\\n\\n0 ‚Üí Sair\\n\\\"\\\"\\\")\\n\\n        op = input_safe(\\\"Op√ß√£o: \\\")\\n\\n        if op == \\\"0\\\":\\n            break\\n\\n        elif op == \\\"1\\\":\\n            pacote = escolher_pacote()\\n            prospect.run(idioma, pacote)\\n\\n        elif op == \\\"2\\\":\\n            pacote = escolher_pacote()\\n            slugify.run(pacote)\\n\\n        elif op == \\\"3\\\":\\n            pacote = escolher_pacote()\\n            dedup.run(pacote)\\n\\n        elif op == \\\"4\\\":\\n            pacote = escolher_pacote()\\n            synopsis.run(pacote)\\n\\n        elif op == \\\"5\\\":\\n            pacote = escolher_pacote()\\n            review.run(pacote)\\n\\n        elif op == \\\"6\\\":\\n            pacote = escolher_pacote()\\n            covers.run(pacote)\\n\\n        elif op == \\\"7\\\":\\n            pacote = escolher_pacote()\\n            publish.run(pacote)\\n\\n        elif op == \\\"8\\\":\\n            log(\\\"Exportando Site Transcript‚Ä¶\\\")\\n            export_state_transcript(\\\"site\\\")\\n            log(\\\"Conclu√≠do.\\\")\\n\\n        elif op == \\\"9\\\":\\n            log(\\\"Exportando Pipeline Transcript‚Ä¶\\\")\\n            export_state_transcript(\\\"pipeline\\\")\\n            log(\\\"Conclu√≠do.\\\")\\n\\n        elif op == \\\"10\\\":\\n            log(\\\"Exportando Full Transcript‚Ä¶\\\")\\n            export_state_transcript(\\\"full\\\")\\n            log(\\\"Conclu√≠do.\\\")\\n\\n        else:\\n            print(\\\"Op√ß√£o inv√°lida.\\\\n\\\")\\n\\n\\n# =========================\\n# BOOTSTRAP\\n# =========================\\n\\nif __name__ == \\\"__main__\\\":\\n    main()\\n\\n\\n# =========================\\n# BOOTSTRAP\\n# =========================\\n\\nif __name__ == \\\"__main__\\\":\\n    main()\\n\",\n    \"scripts\\\\core\\\\db.py\": \"import sqlite3\\nfrom pathlib import Path\\n\\n# path absoluto garantido\\nDB_PATH = Path(__file__).resolve().parent.parent / \\\"data\\\" / \\\"books.db\\\"\\n\\n\\ndef get_conn():\\n\\n    DB_PATH.parent.mkdir(parents=True, exist_ok=True)\\n\\n    conn = sqlite3.connect(DB_PATH)\\n\\n    ensure_schema(conn)\\n\\n    return conn\\n\\n\\n# =========================\\n# SCHEMA\\n# =========================\\n\\ndef ensure_schema(conn):\\n\\n    cur = conn.cursor()\\n\\n    cur.execute(\\\"\\\"\\\"\\n    CREATE TABLE IF NOT EXISTS livros (\\n\\n        id TEXT PRIMARY KEY,\\n\\n        titulo TEXT,\\n        slug TEXT,\\n\\n        autor TEXT,\\n        descricao TEXT,\\n\\n        isbn TEXT,\\n        ano_publicacao INTEGER,\\n\\n        imagem_url TEXT,\\n\\n        idioma TEXT,\\n        cluster TEXT,\\n        fonte TEXT,\\n\\n        status_slug INTEGER DEFAULT 0,\\n        status_dedup INTEGER DEFAULT 0,\\n        status_synopsis INTEGER DEFAULT 0,\\n        status_review INTEGER DEFAULT 0,\\n        status_cover INTEGER DEFAULT 0,\\n        status_publish INTEGER DEFAULT 0,\\n\\n        created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\\n        updated_at DATETIME DEFAULT CURRENT_TIMESTAMP\\n    );\\n    \\\"\\\"\\\")\\n\\n    conn.commit()\\n\",\n    \"scripts\\\\core\\\\logger.py\": \"import time\\nimport threading\\nfrom datetime import datetime\\n\\nlast_activity = time.time()\\n\\n\\ndef log(msg):\\n\\n    global last_activity\\n\\n    now = datetime.now().strftime(\\\"%H:%M:%S\\\")\\n    print(f\\\"[{now}] {msg}\\\")\\n\\n    last_activity = time.time()\\n\\n\\ndef start_heartbeat():\\n\\n    def beat():\\n\\n        while True:\\n\\n            elapsed = int(time.time() - last_activity)\\n\\n            now = datetime.now().strftime(\\\"%H:%M:%S\\\")\\n            print(f\\\"[{now}] Script ativo‚Ä¶ √∫ltimo evento h√° {elapsed}s\\\")\\n\\n            time.sleep(30)\\n\\n    threading.Thread(target=beat, daemon=True).start()\\n\",\n    \"scripts\\\\core\\\\state.py\": \"import json\\nfrom pathlib import Path\\n\\nSTATE_PATH = Path(\\\"scripts/data/state.json\\\")\\n\\n\\ndef load_state():\\n\\n    if not STATE_PATH.exists():\\n        return {}\\n\\n    with open(STATE_PATH, \\\"r\\\", encoding=\\\"utf-8\\\") as f:\\n        return json.load(f)\\n\\n\\ndef save_state(data):\\n\\n    STATE_PATH.parent.mkdir(parents=True, exist_ok=True)\\n\\n    with open(STATE_PATH, \\\"w\\\", encoding=\\\"utf-8\\\") as f:\\n        json.dump(data, f, indent=2)\\n\",\n    \"scripts\\\\dashboard\\\\dashboard.py\": \"import sqlite3\\nimport streamlit as st\\nimport pandas as pd\\n\\nDB_PATH = \\\"scripts/data/books.db\\\"\\n\\n# =========================\\n# DB\\n# =========================\\n\\ndef get_conn():\\n    return sqlite3.connect(DB_PATH)\\n\\n\\ndef load_data():\\n    conn = get_conn()\\n    df = pd.read_sql_query(\\\"SELECT * FROM books\\\", conn)\\n    conn.close()\\n    return df\\n\\n\\n# =========================\\n# PAGE CONFIG\\n# =========================\\n\\nst.set_page_config(\\n    page_title=\\\"Dashboard ‚Äî Ingest Livros\\\",\\n    layout=\\\"wide\\\"\\n)\\n\\nst.title(\\\"üìö Dashboard de Progresso ‚Äî Ingest Pipeline\\\")\\n\\n# =========================\\n# LOAD\\n# =========================\\n\\ndf = load_data()\\n\\nif df.empty:\\n    st.warning(\\\"Banco local vazio.\\\")\\n    st.stop()\\n\\n\\n# =========================\\n# METRICS\\n# =========================\\n\\ncol1, col2, col3, col4 = st.columns(4)\\n\\ncol1.metric(\\\"Total livros\\\", len(df))\\ncol2.metric(\\\"Com sinopse\\\", df['sinopse'].sum())\\ncol3.metric(\\\"Com capa\\\", df['capa'].sum())\\ncol4.metric(\\\"Publicados\\\", df['publicado'].sum())\\n\\n\\n# =========================\\n# PIPELINE STATUS\\n# =========================\\n\\nst.subheader(\\\"Status por etapa\\\")\\n\\nstatus_data = {\\n    \\\"Etapa\\\": [\\n        \\\"Prospectado\\\",\\n        \\\"Slug\\\",\\n        \\\"Deduplicado\\\",\\n        \\\"Sinopse\\\",\\n        \\\"Revisado\\\",\\n        \\\"Capa\\\",\\n        \\\"Publicado\\\"\\n    ],\\n    \\\"Conclu√≠dos\\\": [\\n        df['prospectado'].sum(),\\n        df['slugger'].sum(),\\n        df['dedup'].sum(),\\n        df['sinopse'].sum(),\\n        df['revisado'].sum(),\\n        df['capa'].sum(),\\n        df['publicado'].sum(),\\n    ]\\n}\\n\\nstatus_df = pd.DataFrame(status_data)\\n\\nst.bar_chart(status_df.set_index(\\\"Etapa\\\"))\\n\\n\\n# =========================\\n# IDIOMA DISTRIBUI√á√ÉO\\n# =========================\\n\\nst.subheader(\\\"Distribui√ß√£o por idioma\\\")\\n\\nif 'idioma' in df.columns:\\n    idioma_counts = df['idioma'].value_counts()\\n    st.bar_chart(idioma_counts)\\n\\n\\n# =========================\\n# TABELA DETALHADA\\n# =========================\\n\\